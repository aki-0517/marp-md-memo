## 📊 NanoPlot QC 評価（定量的）

| 指標 | 結果 | 比較基準 | 評価 | コメント |
|------|------|----------|------|----------|
| **総リード数** | **934,886** | ONTシーケンスでは10万以上が一般的 | ✅ 十分 | 高カバレッジのアセンブリが可能 |
| **総塩基数** | **8.36 Gb** | *D. discoideum* のゲノム \~34 Mb → 必要カバレッジ=34 Mb × 50 = **1.7 Gb** | ✅ **246×カバレッジ** | 十分以上の冗長性。フィルタ後でも問題なし |
| **平均リード長** | **8,941 bp** | ONTリード平均 5–15 kb が一般的 | ⭕ | |
| **リードN50** | **12,777 bp** | RavenやFlye推奨N50 >10 kb | ✅ 適正範囲 | 構造的に強いアセンブリに貢献 |
| **最大リード長** | **139,714 bp** | Flye推奨 >50 kb あればよい | ✅ 非常に良好 | 長距離構造決定に有利 |
| **平均品質スコア** | **13.8** | ONT通常分布 10–15 | ⭕ | |
| **Q>15 リード割合** | **44.2%** | Medaka推奨：Q>15で50%以上あれば良い | ❌ やや低め | フィルタしてからアセンブリ or polishing重視 |
| **Q>20 リード割合** | **1.0%** | 理想は10%以上（次世代フローセルで達成可能） | ❌ 低 | これはONTの限界。Pilonなどで補正必須 |

---

## 📌 評価まとめ（定量的）

| 指標カテゴリ        | 結論                                                 |
| ------------- | -------------------------------------------------- |
| **量（カバレッジ）**  | **246×** → 十分以上。フィルタ後も余裕                           |
| **長さ（N50）**   | **12.7 kb** → 十分。Flye, Raven対応水準                   |
| **精度（品質スコア）** | **Q15超 = 44.2%** → polishing必須。Medakaだけでは不十分な可能性あり |
| **構造解像度**     | **最大リード = 139 kb** → 良好。リピート領域も越えられる可能性大           |

---

## 🔧 推奨アクション（定量評価に基づく）

1. **リードフィルタリング**（`Filtlong`等）

   * 条件例：長さ > 2,000 bp、Q > 10 または >Q15
   * **仮にQ15未満を除去してもカバレッジ >100× 残る**

2. **アセンブリツール選定**

   * `Flye` or `Raven`：10 kb以上のN50と高カバレッジに適している
   * `Canu`：高精度で時間コストはやや高
   * → **推奨：Flye**

3. **ポリッシング**

   * ONTのみ：`Medaka` → **限界あり**
   * Illumina併用可：`Pilon` or `NextPolish` → **精度向上期待**
   * → **併用を強く推奨**

4. **QC再評価**

   * アセンブリ後：`QUAST`, `BUSCO`で定量評価継続
   * ゴール：**BUSCO Complete > 95%**, **N50 > 1 Mb**, **Contig数 ≈ 染色体数（8）**


---

## 📉 なぜ「過剰カバレッジ」がアセンブリに悪影響を与えるか？

| 問題             | 説明                                                             |
| -------------- | -------------------------------------------------------------- |
| **リードエラーの蓄積**  | ONTリードは誤差（主にインデル）が多いため、カバレッジが高すぎると**エラーの誤った合意**が起き、アセンブリ精度が下がる |
| **リピート領域の誤解釈** | リピートに富んだゲノムでは、**短い低品質リードが重複領域を誤って橋渡し**して誤結合する可能性が高まる           |
| **リソース消費の増大**  | 計算コストとメモリが増え、処理が不安定に。特に `Canu` や `Shasta` で顕著                  |
| **ノイズリードの影響**  | 短くて低品質なリードが多数混在すると、誤ったコンセンサスを導きやすい                             |

🧠 一般に、**ONTリードでの最適カバレッジは 30–60× 程度**です（FlyeやCanuもこの範囲を推奨）。

---

## ✅ フィルタ戦略（目標：高品質なサブセットで50–60×カバレッジ）

### 📌 1. フィルタ条件の決定

| 指標            | 推奨カットオフ                             | 理由                                      |
| ------------- | ----------------------------------- | --------------------------------------- |
| **リード長**      | `--min_length 3,000`                | 短すぎるリードは誤マッピング・誤接続の元                    |
| **クオリティ**     | `--min_mean_q 12〜15`                | Q15で約97%正確（1 error/50bp）→ polishingしやすい |
| **ターゲットベース数** | `--target_bases 2000000000`（= 2 Gb） | ゲノム34 Mb × 60× = 2.04 Gb                |

---

## 🛠️ 実行例：Filtlongによるフィルタリング

```bash
filtlong \
  --min_length 3000 \
  --min_mean_q 12 \
  --target_bases 2000000000 \
  Dicty_gDNA_NEB-2.fastq \
  > Dicty_filtered.fastq
```

* `--min_length`: 3 kb未満のリードを除外（assemblyに不要）
* `--min_mean_q`: 平均Q12未満を除外（error-prone）
* `--target_bases`: 全体で約60×カバレッジを残すように自動選択（優先順位はスコアに従う）

🎯 **Filtlongは長くて高品質なリードを優先して選別**します。

---

## 📈 フィルタ後に期待される結果

| 指標   | フィルタ前   | フィルタ後（目安）            |
| ---- | ------- | -------------------- |
| 総塩基数 | 8.36 Gb | \~2.0 Gb             |
| リード数 | 934,886 | \~200,000 以下（≒高品質のみ） |
| 平均長  | \~9 kb  | より高くなる（スコア優先のため）     |
| 平均Q  | 13.8    | 上昇（低品質除去のため）         |

---

## 🧭 まとめ：戦略の意図

* **目標**：FlyeやRavenなどのアセンブラが**高精度な構造構築をしやすい**ように、良質なリードだけを残す
* **カバレッジ制限**は、**誤ったコンセンサスの形成を防ぐための“ノイズ除去”**
* この処理で、**assembly → polishing → BUSCO/QUAST評価**という流れの精度が最大化される

---

## ✅ Filtlong フィルタリングコマンド

```bash
filtlong \
  --min_length 3000 \
  --min_mean_q 12 \
  --target_bases 2000000000 \
  Dicty_gDNA_NEB-2.fastq \
  > Dicty_filtered.fastq
```

---

## 🔍 各オプションの意味

| オプション                       | 内容                                   |
| --------------------------- | ------------------------------------ |
| `--min_length 3000`         | 3,000 bp 未満のリードを除外（短すぎて構造構築に不利）      |
| `--min_mean_q 12`           | Q12 未満のリードを除外（誤り率 >6.3%）             |
| `--target_bases 2000000000` | 出力合計を2 Gb（= \~60×）に制限。スコア（長さ×品質）で選抜  |
| `Dicty_gDNA_NEB-2.fastq`    | 入力FASTQファイル                          |
| `>`                         | 高品質リードのみを `Dicty_filtered.fastq` に出力 |

---

以下は、**Filtlong によるフィルタリング後の NanoPlot 結果（`NanoPlot-report02.html`）** に基づく定量的評価と、**期待値との比較**です。

---

## ✅ フィルタ後 NanoPlot QC 結果（定量評価）

| 指標             | フィルタ後の結果       | フィルタ前     | 期待値（目標）        | 評価 | コメント                     |
| -------------- | -------------- | --------- | -------------- | -- | ------------------------ |
| **総リード数**      | **186,107**    | 934,886   | \~200,000 以下   | ✅  | 高品質なリードのみ選抜されている         |
| **総塩基数**       | **2.05 Gb**    | 8.36 Gb   | \~2.0 Gb（=60×） | ✅  | 目標カバレッジにぴったり             |
| **平均リード長**     | **11,036 bp**  | 8,941 bp  | 高いほどよい         | ✅  | 長くて構造決定に有利なリード中心に構成されている |
| **リードN50**     | **13,741 bp**  | 12,777 bp | >10 kb         | ✅  | より長いリードが選ばれている           |
| **最大リード長**     | **139,714 bp** | 同じ        | >50 kb         | ✅  | リピート領域をまたぐ能力あり           |
| **平均品質スコア**    | **14.7**       | 13.8      | ≥14 推奨         | ✅  | 精度向上。polishing効率も良化      |
| **Q>15 リード割合** | **66.3%**      | 44.2%     | ≥50%           | ✅  | Medaka要件を満たしている          |
| **Q>20 リード割合** | **2.5%**       | 1.0%      | ≥10%（理想）       | ❌  | ONT限界。Illumina併用で補正推奨    |

---

## 📌 フィルタ後の達成状況（まとめ）

| 評価軸            | 達成度                   | コメント                       |
| -------------- | --------------------- | -------------------------- |
| **量（カバレッジ）**   | ✅ **60×を維持**          | 無駄なくリード削減できた               |
| **リード長**       | ✅ **平均・N50ともに向上**     | アセンブリに有利な構造的長さ確保           |
| **品質スコア**      | ✅ **平均Q14.7、Q15超66%** | polishingに理想的な分布           |
| **超高品質（Q>20）** | ❌ **2.5%**            | ONT由来の制限、Illumina必須ではないが推奨 |

---

## ✅ 結論と今後の方針

🎯 **Filtlong によるフィルタリングは目標通りに成功**し、今後のアセンブリステップに最適なデータセットが得られています。

### 🔧 次ステップ

1. **アセンブリ（推奨：Flye）**

   * `--nano-raw Dicty_filtered.fastq` を入力に

2. **Polishing**

   * ONTのみ：`Medaka`
   * 可能ならIllumina併用 → `Pilon`, `NextPolish`

3. **評価**

   * `BUSCO`, `QUAST`, `dotplot` による構造評価と完全性チェック

---